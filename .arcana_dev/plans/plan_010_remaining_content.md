# Plan: 남은 GDD 컨텐츠 완성

## 목표
GDD에 따라 모든 챕터 컨텐츠를 완성하고 게임 플로우 검증

## 현재 상태 분석

### 완료된 시스템
- [x] 코어 게임플레이 (이동, 공격, 충돌)
- [x] 하트 시스템 (3개의 심장)
- [x] 심장 게이지 / 스킬 시스템
- [x] 던전 생성기
- [x] 저장/로드 시스템
- [x] 대화 시스템
- [x] 인벤토리 시스템
- [x] 비주얼 업그레이드 (타격감, 이펙트)

### 완료된 챕터 컨텐츠
- [x] 챕터 1: 이그드라 보스, 대화, NPC
- [x] 챕터 2: 발두르 보스, 대화, NPC (눈먼 기사)
- [x] 챕터 3: 실렌시아 보스, 대화, NPC (말 없는 수녀, 배교한 사제)
- [x] 챕터 4: 리리아나 보스, 대화, NPC (정원사)
- [x] 챕터 5: 그림자 보스, 대화, NPC (미래의 자신)
- [x] 챕터 6: 망각의 화신 보스, 대화, NPC (잊혀진 현자)

## 남은 구현 항목

### 1. 스토리 아이템 시스템 확장
- [x] 챕터별 스토리 아이템 추가 (보물방에서 드롭)
  - 부서진 나뭇잎 펜던트 (Ch1) ✅
  - 깨진 왕관 조각 (Ch2) ✅
  - 첫 번째 기억 조각 (Ch3) ✅
  - 리리아나의 반지 (Ch4) ✅
  - 그림자의 파편 (Ch5) ✅
  - 망각의 눈물 (Ch6 - 보스 드롭) ✅
- [x] 스토리 아이템 획득 시 대화 트리거 ✅
- [x] 숨겨진 아이템 배치 (트루 엔딩 필수)
  - 약속의 반지 (Ch4 일반방 오른쪽 상단) ✅
  - 첫 번째 기억의 결정 (Ch5 시작방 좌측) ✅

### 2. 환경 스토리텔링 강화
- [x] 벽화/비문 발견 시 텍스트 표시 ✅
- [x] 각 챕터별 분위기에 맞는 배경 요소 ✅
  - story_object.dart: 환경 오브젝트 컴포넌트
  - environment_dialogues.dart: 챕터별 환경 대화 (12개)
  - dungeon_manager.dart: _spawnStoryObjectsForRoom() 메서드

### 3. 기억 회복 시스템
- [x] 기억 단편 획득 시 회상 장면 ✅
  - ch3_memory_recovery (첫 번째 기억 회복)
  - ch5_memory_corridor (기억의 복도)
  - ch5_shadow_integration (그림자 통합)
- [x] 세 개의 심장 완성 시 트루 엔딩 조건 체크 ✅

### 4. BGM 통합
- [x] 챕터별 BGM 설정 ✅
- [x] 보스별 페이즈별 BGM 전환 ✅
- [x] 챕터 3 Phase 3 무음 처리 ✅

### 5. 최종 테스트
- [ ] 전체 플로우 테스트 (Ch1~Ch6)
- [ ] 엔딩 분기 테스트 (노멀/트루)
- [ ] 저장/로드 테스트

## 우선순위

1. **High**: BGM 통합 (게임 분위기에 필수)
2. **Medium**: 스토리 아이템 추가
3. **Low**: 환경 스토리텔링 (시간 여유 시)

## 체크리스트
- [x] 스토리 아이템 모델 확장 (item.dart) - 이미 완료
- [x] 챕터별 BGM 트랙 설정 (audio_manager.dart) - 완료
  - [x] 챕터별 던전 BGM 분기
  - [x] 챕터별 보스 BGM 분기
  - [x] 챕터 3 Phase 3 무음 처리
  - [x] 챕터 6 최종 페이즈 BGM
- [x] 보스 드롭 테이블 설정 - 모든 보스 완료
- [x] 트루 엔딩 조건 플래그 설정
  - [x] has_heart_of_past (ch4_epilogue)
  - [x] has_heart_of_present (ch5_shadow_integration)
  - [x] has_all_memory_crystals (ch5_epilogue)
- [x] 망각의 화신 드롭 테이블 수정 (oblivionTear 추가)
- [x] 스토리 아이템 획득 대화 트리거 - 완료
  - [x] ch1_item_pendant (부서진 나뭇잎 펜던트)
  - [x] ch2_item_crown (깨진 왕관 조각)
  - [x] ch3_item_memory (첫 번째 기억 조각)
  - [x] ch4_item_ring (리리아나의 반지)
  - [x] ch4_hidden_ring (약속의 반지 - 트루엔딩)
  - [x] ch5_hidden_crystal (기억의 결정 - 트루엔딩)
  - [x] ch5_item_shadow (그림자의 파편)
  - [x] ch6_item_tear (망각의 눈물)
- [ ] 전체 플로우 테스트

## 예상 작업량
- 스토리 아이템: 약 50줄
- BGM 통합: 약 30줄
- 기억 시스템: 약 100줄
- 테스트: 수동 검증

## 시작일
2026-02-05
